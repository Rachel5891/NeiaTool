<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>NEIA Tool - Informed Consent</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; padding: 20px; line-height: 1.5; }
    h1, h2 { color: #333; }
    .hidden { display: none; } 
    .button { background: #007bff; color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 10px; }
    .button:hover { background: #0056b3; }
  </style>
</head>
<body>

<!-- üîπ Informed Consent Section -->
<div id="consentSection">
  <h1>NEIA Pilot Study - Informed Consent</h1>
  <div class="consent-box">
    <h2>Purpose of the Study</h2>
    <p>The purpose of this pilot study is to evaluate the effectiveness and accuracy of a newly developed instrument designed to validate NCLEX questions...</p>

    <h2>What Does the Study Involve?</h2>
    <ul>
      <li>Use the instrument to assess a set of NCLEX questions.</li>
      <li>Provide scores based on the criteria outlined in the instrument.</li>
      <li>Allow your scores to be compared to those generated by our custom AI model.</li>
    </ul>

    <h2>Confidentiality & Risks</h2>
    <p>Your participation is voluntary and you may withdraw at any time...</p>

    <h2>Contact Information</h2>
    <p>The Principal Investigator (PI) of this project is Dr. Anshul Kumar (<a href="mailto:akumar@mghihp.edu">akumar@mghihp.edu</a>).</p>
    <p>The co-investigator is Dr. Rachel Cox Simms (<a href="mailto:rlcox@mghihp.edu">rlcox@mghihp.edu</a>).</p>
    <p>If you have any concerns about this study, please contact the Mass General Brigham IRB at (857) 282-1900.</p>

    <h2>Agreement to Participate</h2>
    <p><strong>By clicking "Submit," you agree to participate in this study. You will receive 5 randomly assigned NCLEX questions. If you do not complete all 5 in one sitting, you can return using the same link as long as you do not clear your cache.</strong></p>

    <button class="button" onclick="startSurvey()">Submit</button>
  </div>
</div>

<!-- üîπ Assigned Forms Section (Hidden Until Consent is Given) -->
<div id="surveySection" class="hidden">
  <h1>Your Assigned NCLEX Questions</h1>
  <p>Click the link below to begin. After completing a form, you will be automatically redirected to the next one.</p>
  <div id="links"></div>
</div>

<script>
// 1Ô∏è‚É£ Full list of available Cognito Forms
var formLinks = [
  "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion1",
  "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion2",
  "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion3",
  "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion4",
  "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion5"
];

// 2Ô∏è‚É£ Number of forms each participant gets
var numLinks = 3;

// 3Ô∏è‚É£ Shuffle function to randomize order
function shuffle(array) {
  let currentIndex = array.length, randomIndex;
  while (currentIndex !== 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
  }
  return array;
}

// 4Ô∏è‚É£ Check if the user has previously consented
var hasConsented = localStorage.getItem("hasConsented");

// 5Ô∏è‚É£ Check if the user already has assigned questions
var storedLinks = localStorage.getItem("savedLinks");
var completedForms = JSON.parse(localStorage.getItem("completedForms")) || [];

if (storedLinks) {
  selectedLinks = JSON.parse(storedLinks);
} else {
  shuffle(formLinks);
  selectedLinks = formLinks.slice(0, numLinks);
  localStorage.setItem("savedLinks", JSON.stringify(selectedLinks));
}

// 6Ô∏è‚É£ Filter out already completed forms
selectedLinks = selectedLinks.filter(link => !completedForms.includes(link));

// 7Ô∏è‚É£ Display the correct section based on consent status
if (hasConsented) {
  document.getElementById("consentSection").style.display = "none";
  document.getElementById("surveySection").classList.remove("hidden");
}

// 8Ô∏è‚É£ If all assigned forms are completed, show a thank you message
if (selectedLinks.length === 0) {
  document.body.innerHTML = "<h1>Thank you! You have completed all assigned forms.</h1>";
} else {
  // 9Ô∏è‚É£ Get the next form link
  var nextForm = selectedLinks[0];

  // üîü Update completed forms when they return from submission
  function markCompleted() {
    completedForms.push(nextForm);
    localStorage.setItem("completedForms", JSON.stringify(completedForms));
  }

  // 1Ô∏è‚É£1Ô∏è‚É£ Display the next form
  var linksDiv = document.getElementById("links");
  var a = document.createElement("a");
  a.href = nextForm;
  a.target = "_self";  // Open in the same window
  a.innerText = "Click here to start your next question";
  a.onclick = markCompleted; // Mark the form as completed when clicked
  linksDiv.appendChild(a);
}

// 1Ô∏è‚É£2Ô∏è‚É£ Function to start the survey after consent is given
function startSurvey() {
  localStorage.setItem("hasConsented", "true");
  document.getElementById("consentSection").style.display = "none";
  document.getElementById("surveySection").classList.remove("hidden");
}
</script>

</body>
</html>




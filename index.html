<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>NEIA Tool - Assigned Questions</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; padding: 20px; line-height: 1.5; }
    h1, h2 { color: #333; }
    .hidden { display: none; } 
    .button { background: #007bff; color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 10px; }
    .button:hover { background: #0056b3; }
  </style>
</head>
<body>

<h1>Welcome to Your NEIA Tool Assessment</h1>
<p>You will be assigned 5 questions. Each time you complete a form, you will be automatically redirected to the next one.</p>
<div id="links"></div>

<script>
// 1) List of available Cognito Forms
var formLinks = [
  "https://www.cognitoforms.com/MGHIHP1/CVINEIA",
  "https://www.cognitoforms.com/MGHIHP1/InfectiousDiseaseSurvey",
  "https://www.cognitoforms.com/MGHIHP1/MonkeypoxPreparationOnCollegeCampuses"
];

// 2) Number of forms each participant gets
var numLinks = 2;

// 3) Shuffle function to randomize order
function shuffle(array) {
  let currentIndex = array.length, randomIndex;
  while (currentIndex !== 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
  }
  return array;
}

// 4) Retrieve saved links from localStorage OR assign new ones
var storedLinks = localStorage.getItem("savedLinks");
var completedForms = JSON.parse(localStorage.getItem("completedForms")) || [];

if (storedLinks) {
  selectedLinks = JSON.parse(storedLinks);
} else {
  shuffle(formLinks);
  selectedLinks = formLinks.slice(0, numLinks);
  localStorage.setItem("savedLinks", JSON.stringify(selectedLinks));
}

// 5) Filter out already completed forms
selectedLinks = selectedLinks.filter(link => !completedForms.includes(link));

// 6) Check if all assigned forms are completed
if (selectedLinks.length === 0) {
  document.body.innerHTML = "<h1>Thank you! You have completed all assigned forms.</h1>";
} else {
  // 7) Get the next form link
  var nextForm = selectedLinks[0];

  // 8) Update completed forms when they return from a submission
  function markCompleted() {
    completedForms.push(nextForm);
    localStorage.setItem("completedForms", JSON.stringify(completedForms));
  }

  // 9) Display the next form
  var linksDiv = document.getElementById("links");
  var a = document.createElement("a");
  a.href = nextForm;
  a.target = "_self";  // Open in the same window
  a.innerText = "Click here to start your next question";
  a.onclick = markCompleted; // Mark the form as completed when clicked
  linksDiv.appendChild(a);
}
</script>

</body>
</html>




<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>NEIA Tool - Informed Consent</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; padding: 20px; line-height: 1.5; }
    h1, h2 { color: #333; }
    .hidden { display: none; }
    .button { background: #007bff; color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 10px; border-radius: 4px; }
    .button:hover { background: #0056b3; }
    .dev-mode { display: flex; justify-content: flex-end; }
    .dev-button { background: #aaa; margin-top: 0; margin-right: 20px; border-radius: 4px; }
  </style>
</head>
<body>

  <!-- ðŸ”¹ Informed Consent Section -->
  <div id="consentSection">
    <h1>NEIA Pilot Study - Informed Consent</h1>
    <div class="consent-box">
      <h2>Purpose of the Study</h2>
      <p>The purpose of this pilot research study is to evaluate the effectiveness and accuracy of a newly developed instrument designed to validate NCLEX-style questions. This will involve comparing your assessment scores with those generated by a custom artificial intelligence (AI) scoring model.</p>

      <h2>What Does the Study Involve?</h2>
      <ul>
        <li>Use the instrument to assess a set of NCLEX-style questions.</li>
        <li>Provide scores based on the criteria outlined in the instrument.</li>
        <li>Allow your scores to be compared to those generated by our custom AI model to assess the instrument's reliability and validity.</li>
        <li>As a token of our appreciation for your time, you will receive a $50 gift card after you complete the survey in its entirety. Receipt of the gift card is contingent on submitting a fully completed survey. Your participation is entirely voluntary, and you may withdraw at any point without penalty. However, to be eligible for the gift card, you must finish and submit the survey. Please note that any information you provide will remain confidential and will be used solely for the purposes of this research study.</li>
      </ul>

      <h2>Confidentiality & Risks</h2>
      <p>There are minimal risks, including the loss of confidentiality. Every effort will be made to maintain confidentiality. Your de-identified information may be shared with other researchers without your additional informed consent.</p>

      <h2>Contact Information</h2>
      <p>The Principal Investigator (PI) of this project is Dr. Anshul Kumar (<a href="mailto:akumar@mghihp.edu">akumar@mghihp.edu</a>).</p>
      <p>The co-investigator is Dr. Rachel Cox Simms (<a href="mailto:rlcox@mghihp.edu">rlcox@mghihp.edu</a>).</p>
      <p>If you would like to speak to someone not involved in this research about your rights as a research subject, or any concerns or complaints you may have about the research, contact the Mass General Brigham IRB at (857) 282-1900.</p>

      <h2>Agreement to Participate</h2>
      <p><strong>By clicking "Submit," you agree to participate in this study. You will first complete a brief demographic questionnaire, followed by a short training walkthrough, and then evaluate 6 randomly assigned NCLEX-style questions. If you do not complete all 6 in one sitting, you can return using the same link as long as you do not clear your cache.</strong></p>

      <button type="button" class="button" onclick="startSurvey()">Submit</button>
    </div>
  </div>

  <!-- ðŸ”¹ Assigned Forms Section -->
  <div id="surveySection" class="hidden">
    <h1>Your Assigned NCLEX Questions</h1>
    <p>Click the link below to begin. After completing a form, you will be automatically redirected to the next one.</p>
    <div id="links"></div>
  </div>

  <!-- ðŸ”¹ Developer Mode Button -->
  <div class="dev-mode">
    <button type="button" class="button dev-button" onclick="enableDevMode()">Developer Mode: Reset</button>
  </div>

  <script>
    function shuffle(array) {
      let currentIndex = array.length, randomIndex;
      while (currentIndex !== 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
      }
      return array;
    }

    // Group 1: Questions 1â€“5
    const group1 = [
      "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion32",
      "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion42",
    ];

    // Group 2: Questions 6â€“10
    const group2 = [
      "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion62",
      "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion82",
    ];

    // Group 3: Questions 11â€“15
    const group3 = [
      "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion112",
      "https://www.cognitoforms.com/MGHIHP1/NEIAToolQuestion122",
    ];

    const hasConsented = localStorage.getItem("hasConsented");
    const completedForms = JSON.parse(localStorage.getItem("completedForms")) || [];

    let selectedLinks;

    if (localStorage.getItem("savedLinks")) {
      selectedLinks = JSON.parse(localStorage.getItem("savedLinks"));
    } else {
      shuffle(group1);
      shuffle(group2);
      shuffle(group3);
      selectedLinks = shuffle([
        ...group1.slice(0, 2),
        ...group2.slice(0, 2),
        ...group3.slice(0, 2),
      ]);
      localStorage.setItem("savedLinks", JSON.stringify(selectedLinks));
    }

    selectedLinks = selectedLinks.filter(link => !completedForms.includes(link));

    if (hasConsented) {
      document.getElementById("consentSection").style.display = "none";
      document.getElementById("surveySection").classList.remove("hidden");
      renderNextLink();
    }

    function startSurvey() {
      localStorage.setItem("hasConsented", "true");
      window.open("https://www.cognitoforms.com/MGHIHP1/NEIAIntroAndTraining", "_blank");
      document.getElementById("consentSection").style.display = "none";
      document.getElementById("surveySection").classList.remove("hidden");
      renderNextLink();
      window.scrollTo(0, 0);
    }

    function renderNextLink() {
      const div = document.getElementById("links");
      div.innerHTML = "";
      if (selectedLinks.length === 0) {
        div.innerHTML = "<h2>Thank you! You have completed all assigned forms. You may now close this window. </h2>";
        return;
      }
      const next = selectedLinks[0];
      const a = document.createElement("a");
      a.href = next;
      a.target = "_self";
      a.innerText = "Click here to start your next question";
      a.onclick = () => {
        completedForms.push(next);
        localStorage.setItem("completedForms", JSON.stringify(completedForms));
      };
      div.appendChild(a);
    }

    function enableDevMode() {
      if (confirm("Clear all data?")) {
        localStorage.clear();
        location.reload();
      }
    }
  </script>
</body>
</html>
